<%@ page isErrorPage="true" contentType="text/html; charset=UTF-8" %>
<html>
<head><title>頁面發生錯誤</title></head>
<body>
<%
    // Tomcat 給的是 root cause，要自己往上找外層 Exception
    Throwable outer = exception;
    Throwable current = exception;
    while (current != null) {
        outer = current; 
        current = current.getCause();
    }

    // outer 現在是最外層 exception（例如 ServletException）
    StackTraceElement[] trace = outer.getStackTrace();
    if (trace != null && trace.length > 0) {
        StackTraceElement first = trace[0];
%>
        <h3>發生例外：<%= outer.getClass().getSimpleName() %></h3>
        <p>訊息：<%= outer.getMessage() %></p>
        <p>行號：<%= first.getLineNumber() %></p>
<%
    } else {
%>
        <p>無法取得行號。</p>
<%
    }
%>
</body>
</html>
