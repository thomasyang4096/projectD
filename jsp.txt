<%@ page isErrorPage="true" contentType="text/html; charset=UTF-8" %>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>系統錯誤</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f8f8f8; }
    .error-box { background: #fff; padding: 20px; border: 1px solid #ddd; border-radius: 6px; max-width: 800px; }
  </style>
</head>
<body>
<div class="error-box">
  <h2>系統發生錯誤</h2>
<%
    // JSP 內建 exception 變數 → 永遠是 root cause
    Throwable t = exception;

    StackTraceElement first = null;
    if (t != null && t.getStackTrace() != null && t.getStackTrace().length > 0) {
        first = t.getStackTrace()[0];
    }
%>

<% if (t != null) { %>
  <p><strong>例外類型：</strong> <%= t.getClass().getName() %></p>
  <p><strong>訊息：</strong> <%= t.getMessage() == null ? "(無訊息)" : t.getMessage() %></p>
  <% if (first != null) { %>
    <p><strong>行號：</strong> <%= first.getClassName() %>.<%= first.getMethodName() %>() 第 <%= first.getLineNumber() %> 行</p>
  <% } else { %>
    <p>無法取得行號</p>
  <% } %>
<% } else { %>
  <p>沒有可用的 Exception</p>
<% } %>

  <p style="color:#666; font-size:0.9em; margin-top:20px;">請聯絡系統管理員處理。</p>
</div>
</body>
</html>
